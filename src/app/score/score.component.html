<div name="page" class="px-[10%] pb-8">
  <div name="header-div" class="flex flex-row justify-between mb-8 pt-[2.5%]">
    <p class="text-primary font-semibold text-2xl">
      Score #{{ score.requestId }}
    </p>
    <div class="flex flex-row">
      <button
        type="button"
        class="pl-6 pr-6 pt-2 pb-2 enabled:bg-white enabled:text-secondary rounded-md border font-bold"
        (click)="editScore()"
        *ngIf="score.canEdit"
      >
        {{'editScore' | translate}}
      </button>
      <button
        type="button"
        class="pl-6 pr-6 pt-2 pb-2 ml-2 enabled:bg-secondary enabled:text-white rounded-md border font-bold"
        routerLink="/score/new"
      >
        {{'scorePrint' | translate}}
      </button>
    </div>
  </div>
  <div
    name="results"
    class="px-8 py-6 bg-white shadow border-tone-1 rounded-lg border-solid border flex flex-col gap-4 mb-4"
  >
    <div name="score-results">
      <app-risk-score
        [RiskValue]="score.riskValue"
        [RiskClass]="score.riskClass"
        [RiskHeader]="schema.riskHeader"
        [ScoreHeader]="schema.scoreHeader"
        [ScoreValue]="score.classifier_score"
        [RecommendationHeader]="schema.recommendationHeader"
        [Recommendation]="score.recommendationSummary"
        [RecommendationLong]="score.recommendationLongText"
      />
    </div>
    <div name="recommendation-details">
      <button
        class="rounded pb-2 pt-2.5 text-xs font-medium uppercase leading-normal text-text hover:bg-primary-600"
        type="button"
        (click)="toggleTable()"
      >
        {{
          tableHidden
            ? "▶ " + schema.recommendationTableHeader
            : "▼ " + schema.recommendationTableHeader
        }}
      </button>
      <div
        class="{{
          tableHidden ? '!visible hidden' : 'visible'
        }} rounded-lg bg-white flex flex-col gap-2"
      >
        <app-recommendation-table
          [categories]="relevantRecommendationCategories"
          [recommendationHeader]="schema.recommendationHeader"
          [scoreRangeHeader]="schema.recommendationScoreRangeHeader"
          [probabilityHeader]="schema.recommendationProbabilityHeader"
        ></app-recommendation-table>
        <div
          name="footer"
          class="flex flex-col items-start gap-[0.0625] self-stretch"
        >
          <p class="text-label text-xs font-bold">{{ schema.infoText }}</p>
          <div class="flex flex-row gap-2">
            <span *ngFor="let key of abbreviationKeys">
              <p class="text-label text-xs font-medium">
                {{ key }} = {{ schema.abbreviations[key] }};
              </p>
            </span>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="score.warnings?.length" name="warnings">
      <app-warning
        [warningHeader]="schema.warningHeader"
        [warnings]="score.warnings"
      ></app-warning>
    </div>
    <div name="footnotes" class="flex flex-col gap-1 pt-4">
      <app-footnote
        [header]="schema.cadDefinitionHeader"
        [text]="schema.cadDefinition"
      ></app-footnote>
      <app-footnote
        [header]="schema.footnoteHeader"
        [text]="schema.footnote"
      ></app-footnote>
      <app-footnote
        [header]="schema.intendedUseHeader"
        [text]="schema.intendedUse"
      ></app-footnote>
    </div>
  </div>
  <div
    name="values"
    class="px-8 py-6 bg-white shadow border-tone-1 rounded-lg border-solid border flex flex-col gap-4 my-4"
  >
    <div
      name="patientInfo"
      class="px-8 py-6 bg-white shadow-inner border-tone-1 rounded-lg border-solid border grid grid-cols-4 gap-4 mb-4"
    >
      <app-biomarker-info
        Header="Patient Name"
        Value="{{ firstname }} {{ lastname }}"
        class="col-span-2"
      ></app-biomarker-info>
      <app-biomarker-info
        Header="Birthdate"
        [Value]="birthdate"
        InfoText="Birthdate of the patient"
        [isDate]="true"
      ></app-biomarker-info>
      <app-biomarker-info
        Header="Input date"
        [Value]="score.biomarkers.createdOn"
        InfoText="Date the Scoring request was made"
        [isDate]="true"
      ></app-biomarker-info>
    </div>
    <div
      name="baseInfo"
      class="px-8 py-6 bg-white shadow-inner border-tone-1 rounded-lg border-solid border grid grid-cols-4 justify-start gap-4 mb-4"
    >
      <app-biomarker-info
        *ngFor="let biomarker of anamnesisMarkers"
        [Header]="biomarker.fieldname"
        [InfoText]="biomarker.infoText"
        [Value]="this.getBiomarkerValue(biomarker.id)"
        [Unit]="this.getBiomarkerUnit(biomarker.id)?.name ?? ''"
      ></app-biomarker-info>
    </div>
    <div
      name="baseInfo"
      class="px-8 py-6 bg-white shadow-inner border-tone-1 rounded-lg border-solid border grid grid-cols-4 justify-start gap-4 mb-4"
    >
      <app-biomarker-info
        *ngFor="let biomarker of medicationMarkers"
        [Header]="biomarker.fieldname"
        [InfoText]="biomarker.infoText"
        [Value]="this.getBiomarkerValue(biomarker.id)"
        [Unit]="this.getBiomarkerUnit(biomarker.id)?.name ?? ''"
      ></app-biomarker-info>
    </div>
    <div
      name="baseInfo"
      class="px-8 py-6 bg-white shadow-inner border-tone-1 rounded-lg border-solid border grid grid-cols-4 justify-start gap-4 mb-4"
    >
      <app-biomarker-info
        *ngFor="let biomarker of valueMarkers"
        [Header]="biomarker.fieldname"
        [InfoText]="biomarker.infoText"
        [Value]="this.getBiomarkerValue(biomarker.id)"
        [Unit]="this.getBiomarkerUnit(biomarker.id)?.name ?? ''"
      ></app-biomarker-info>
    </div>
  </div>
</div>
